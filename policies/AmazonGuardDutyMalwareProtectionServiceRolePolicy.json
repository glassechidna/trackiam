{
  "Arn": "arn:aws:iam::aws:policy/aws-service-role/AmazonGuardDutyMalwareProtectionServiceRolePolicy",
  "CreateDate": "2022-07-19T19:06:53Z",
  "DefaultVersionId": "v2",
  "IsAttachable": true,
  "Path": "/aws-service-role/",
  "PolicyId": "ANPAZKAPJZG4DYKRPKYEO",
  "PolicyName": "AmazonGuardDutyMalwareProtectionServiceRolePolicy",
  "PolicyVersion": {
    "CreateDate": "2024-01-25T22:24:00Z",
    "Document": {
      "Statement": [
        {
          "Action": "ec2:CreateSnapshot",
          "Condition": {
            "ForAnyValue:StringEquals": {
              "aws:TagKeys": "GuardDutyScanId"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:ec2:*:*:snapshot/*",
          "Sid": "CreateSnapshotConditionalStatement"
        },
        {
          "Action": "ec2:CreateSnapshot",
          "Condition": {
            "Null": {
              "aws:ResourceTag/GuardDutyExcluded": "true"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:ec2:*:*:volume/*",
          "Sid": "CreateSnapshotVolumeConditionalStatement"
        },
        {
          "Action": "ec2:CreateTags",
          "Condition": {
            "ForAllValues:StringEquals": {
              "aws:TagKeys": [
                "GuardDutyExcluded",
                "GuardDutyFindingDetected"
              ]
            },
            "StringLike": {
              "ec2:ResourceTag/GuardDutyScanId": "*"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:ec2:*:*:snapshot/*",
          "Sid": "AddTagsToSnapshotPermission"
        },
        {
          "Action": "ec2:CreateTags",
          "Condition": {
            "StringEquals": {
              "ec2:CreateAction": "CreateSnapshot"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:ec2:*:*:*/*",
          "Sid": "CreateTagsPermission"
        },
        {
          "Action": "kms:CreateGrant",
          "Condition": {
            "Bool": {
              "kms:GrantIsForAWSResource": "true"
            },
            "ForAllValues:StringEquals": {
              "kms:GrantOperations": [
                "CreateGrant",
                "Decrypt",
                "DescribeKey",
                "GenerateDataKeyWithoutPlaintext",
                "ReEncryptFrom",
                "ReEncryptTo",
                "RetireGrant"
              ]
            },
            "Null": {
              "aws:ResourceTag/GuardDutyExcluded": "true"
            },
            "StringLike": {
              "kms:EncryptionContext:aws:ebs:id": "snap-*"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:kms:*:*:key/*",
          "Sid": "CreateGrantPermission"
        },
        {
          "Action": [
            "ebs:GetSnapshotBlock",
            "ebs:ListSnapshotBlocks"
          ],
          "Condition": {
            "Null": {
              "aws:ResourceTag/GuardDutyExcluded": "true"
            },
            "StringLike": {
              "aws:ResourceTag/GuardDutyScanId": "*"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:ec2:*:*:snapshot/*",
          "Sid": "EBSDirectAPIPermissions"
        },
        {
          "Action": [
            "ec2:DeleteSnapshot",
            "ec2:ModifySnapshotAttribute"
          ],
          "Condition": {
            "Null": {
              "aws:ResourceTag/GuardDutyExcluded": "true"
            },
            "StringLike": {
              "ec2:ResourceTag/GuardDutyScanId": "*"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:ec2:*:*:snapshot/*",
          "Sid": "DeleteAndShareSnapshotPermission"
        },
        {
          "Action": [
            "ec2:ModifySnapshotAttribute"
          ],
          "Condition": {
            "StringEquals": {
              "ec2:Add/group": "all"
            }
          },
          "Effect": "Deny",
          "Resource": "arn:aws:ec2:*:*:snapshot/*",
          "Sid": "PreventPublicAccessToSnapshotPermission"
        },
        {
          "Action": [
            "kms:ReEncryptFrom",
            "kms:ReEncryptTo"
          ],
          "Condition": {
            "Null": {
              "aws:ResourceTag/GuardDutyExcluded": "true"
            },
            "StringLike": {
              "kms:ViaService": "ec2.*.amazonaws.com"
            }
          },
          "Effect": "Allow",
          "Resource": "arn:aws:kms:*:*:key/*",
          "Sid": "ShareSnapshotKMSPermission"
        },
        {
          "Action": "kms:DescribeKey",
          "Effect": "Allow",
          "Resource": "arn:aws:kms:*:*:key/*",
          "Sid": "DescribeKeyPermission"
        },
        {
          "Action": [
            "ec2:DescribeInstances",
            "ec2:DescribeSnapshots",
            "ec2:DescribeVolumes",
            "ecs:DescribeTasks",
            "ecs:ListClusters",
            "ecs:ListContainerInstances",
            "ecs:ListTasks",
            "eks:DescribeCluster"
          ],
          "Effect": "Allow",
          "Resource": "*",
          "Sid": "DescribeAndListPermissions"
        },
        {
          "Action": [
            "logs:CreateLogGroup",
            "logs:DescribeLogGroups",
            "logs:PutRetentionPolicy"
          ],
          "Effect": "Allow",
          "Resource": "arn:aws:logs:*:*:log-group:/aws/guardduty/*",
          "Sid": "GuardDutyLogGroupPermission"
        },
        {
          "Action": [
            "logs:CreateLogStream",
            "logs:DescribeLogStreams",
            "logs:PutLogEvents"
          ],
          "Effect": "Allow",
          "Resource": "arn:aws:logs:*:*:log-group:/aws/guardduty/*:log-stream:*",
          "Sid": "GuardDutyLogStreamPermission"
        }
      ],
      "Version": "2012-10-17"
    },
    "IsDefaultVersion": true,
    "VersionId": "v2"
  },
  "UpdateDate": "2024-01-25T22:24:00Z"
}
